<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>字符编码 | 唐昊的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="字符编码在计算机内部，所有的信息最终都表示为一个二进制的字符串。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。而字符是语言意义上的符号，范围就不一定了。
ASCII码上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。ASCII码一共规定了128个字符的编码(">
<meta property="og:type" content="article">
<meta property="og:title" content="字符编码">
<meta property="og:url" content="http://yoursite.com/2015/03/22/字符编码/index.html">
<meta property="og:site_name" content="唐昊的博客">
<meta property="og:description" content="字符编码在计算机内部，所有的信息最终都表示为一个二进制的字符串。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。而字符是语言意义上的符号，范围就不一定了。
ASCII码上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。ASCII码一共规定了128个字符的编码(">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="字符编码">
<meta name="twitter:description" content="字符编码在计算机内部，所有的信息最终都表示为一个二进制的字符串。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。而字符是语言意义上的符号，范围就不一定了。
ASCII码上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。ASCII码一共规定了128个字符的编码(">
  
    <link rel="alternative" href="/atom.xml" title="唐昊的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="https://raw.githubusercontent.com/thddaniel/thddaniel.github.io/master/img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="https://raw.githubusercontent.com/thddaniel/thddaniel.github.io/master/img/anonymous.jpg">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">Tang Hao</a></h1>
		</hgroup>

		

		
			<div class="onoffswitch">
			    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked>
			    <label class="onoffswitch-label" for="myonoffswitch">
			        <span class="onoffswitch-inner"></span>
			        <span class="onoffswitch-switch"></span>
			    </label>
			</div>
		

		<div class="switch-area">
			<section class="first-part">
				<nav class="header-menu">
					<ul>
					
						<li><a href="/">主页</a></li>
			        
						<li><a href="/archives">所有文章</a></li>
			        
						<li><a href="/instagram">相册</a></li>
			        
					</ul>
				</nav>
				<nav class="header-nav">
					<div class="social">
						
							<a class="github" target="_blank" href="https://github.com/thddaniel" title="github">github</a>
				        
							<a class="quora" target="_blank" href="http://www.quora.com/Daniel-Hao-2" title="quora">quora</a>
				        
							<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
				        
							<a class="email" target="_blank" href="mailto:thddaniel92@gmail.com" title="email">email</a>
				        
					</div>
				</nav>
			</section>
			
			
			<section class="second-part">
				<div class="widget tagcloud">
					<a href="/tags/Open-Courses/" style="font-size: 20px;">Open Courses</a><a href="/tags/git/" style="font-size: 15px;">git</a><a href="/tags/创业/" style="font-size: 10px;">创业</a><a href="/tags/思维/" style="font-size: 15px;">思维</a><a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a><a href="/tags/理财/" style="font-size: 10px;">理财</a><a href="/tags/计算机原理/" style="font-size: 10px;">计算机原理</a><a href="/tags/记忆力/" style="font-size: 15px;">记忆力</a>
				</div>
			</section>
			
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://raw.githubusercontent.com/thddaniel/thddaniel.github.io/master/img/anonymous.jpg">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">Tang Hao</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/instagram">相册</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/thddaniel" title="github">github</a>
			        
						<a class="quora" target="_blank" href="http://www.quora.com/Daniel-Hao-2" title="quora">quora</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="email" target="_blank" href="mailto:thddaniel92@gmail.com" title="email">email</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <article id="post-字符编码" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/03/22/字符编码/" class="article-date">
  	<time datetime="2015-03-22T15:18:00.000Z" itemprop="datePublished">2015-03-22</time>
</a>
      
      
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      字符编码
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
              
              <!-- 文章目录开始 -->
                
                  <div id="toc" class="toc-article">
                      <strong class="toc-title">目录Contents</strong>
                  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#字符编码"><span class="toc-number">1.</span> <span class="toc-text">字符编码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ASCII码"><span class="toc-number">1.1.</span> <span class="toc-text">ASCII码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#各个国家的编码"><span class="toc-number">1.2.</span> <span class="toc-text">各个国家的编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unicode编码表"><span class="toc-number">1.3.</span> <span class="toc-text">Unicode编码表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UTF-8的编码规则"><span class="toc-number">1.3.1.</span> <span class="toc-text">UTF-8的编码规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大端小端"><span class="toc-number">1.3.2.</span> <span class="toc-text">大端小端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编码方式"><span class="toc-number">2.</span> <span class="toc-text">编码方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#源文件用不同的编码方式编写，会导致执行结果不一样。"><span class="toc-number">2.1.</span> <span class="toc-text">源文件用不同的编码方式编写，会导致执行结果不一样。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何解决"><span class="toc-number">2.2.</span> <span class="toc-text">如何解决</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#英文字母、汉字的点阵显示"><span class="toc-number">3.</span> <span class="toc-text">英文字母、汉字的点阵显示</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#帧缓冲(framebuffer)"><span class="toc-number">3.1.</span> <span class="toc-text">帧缓冲(framebuffer)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何在屏幕上画出一个点"><span class="toc-number">3.2.</span> <span class="toc-text">如何在屏幕上画出一个点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD显示ascii码"><span class="toc-number">3.3.</span> <span class="toc-text">LCD显示ascii码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD显示汉字"><span class="toc-number">3.4.</span> <span class="toc-text">LCD显示汉字</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Freetype"><span class="toc-number">4.</span> <span class="toc-text">Freetype</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#代码思路"><span class="toc-number">4.1.</span> <span class="toc-text">代码思路</span></a></li></ol></li></ol>
                  </div>
                
             <!-- 文章目录结束 -->
 
        
        <h1 id="字符编码">字符编码</h1><p>在计算机内部，所有的信息最终都表示为一个二进制的字符串。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个<strong>字节（byte）</strong>。而<strong>字符</strong>是语言意义上的符号，范围就不一定了。</p>
<h2 id="ASCII码">ASCII码</h2><p>上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。ASCII码一共规定了128个字符的编码(包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的1位统一规定为0。<br><a id="more"></a></p>
<h2 id="各个国家的编码">各个国家的编码</h2><p>因为其他国家有自己的语言，ascii不够用。例如在中国，hzk16字库是符合GB2312(国标码)的16X16点阵字库。GB2312汉字是由两个字节编码的（范围：A1A1~FEFE)。一个汉字占两个字节，前一个字节为该汉字的<code>区号</code>，后一个字节为该字的<code>位号</code>。每个区记录94个汉字，位号为该字在该区的位置。</p>
<blockquote>
<p>区码：区号-0xa0<br>位码：位号-0xa0<br>位置: （94 *（区码-1）+（位码-1））* 32</p>
</blockquote>
<h2 id="Unicode编码表">Unicode编码表</h2><p>Unicode 是为整合全世界的所有语言文字而诞生的。任何文字在Unicode中都对应一个值，这个值称为代码，UCS-2和UCS-4只规定了代码点和文字之间的对应关系，而规定的储存方式称为<code>UTF</code>。</p>
<p><strong>UTF-8是Unicode的实现方式之一。</strong><code>UTF-8</code>就是在互联网上使用最广的一种Unicode的实现方式。UTF-8最大的一个特点，就是它是一种变长的编码方式。它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。其他实现方式还包括<code>UTF-16</code>（字符用两个字节或四个字节表示）和<code>UTF-32</code>（字符用四个字节表示），不过在互联网上基本不用。</p>
<h3 id="UTF-8的编码规则">UTF-8的编码规则</h3><ol>
<li>对于单字节的符号，字节的第一位设为0，后面7位为这个符号的unicode码。因此对于英语字母，UTF-8编码和ASCII码是相同的。</li>
<li>对于n字节的符号（n&gt;1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的unicode的值。</li>
</ol>
<p>例如：“中”字的UTF-8的值为：E4 B8 AD (1110<code>0100</code>,10<code>111000</code>,10<code>101101</code>),Unicode的值为：100111000101101(4E2D)。</p>
<h3 id="大端小端">大端小端</h3><p>Unicode规范中定义，每一个文件的最前面分别加入一个表示编码顺序的字符，如果一个文本文件的头两个字节是FE FF，就表示该文件采用大头方式；如果头两个字节是FF FE，就表示该文件采用小头方式。</p>
<p>实例：</p>
<ol>
<li>ANSI：文件的编码就是两个字节”D1 CF”，这正是”严”的GB2312编码，这也暗示GB2312是采用大头方式存储的。</li>
<li>Unicode：编码是四个字节”FF FE 25 4E”，其中”FF FE”表明是小头方式存储，真正的编码是4E25。</li>
<li>Unicode big endian：编码是四个字节”FE FF 4E 25”，其中”FE FF”表明是大头方式存储。</li>
<li>UTF-8：编码是六个字节”EF BB BF E4 B8 A5”，前三个字节”EF BB BF”表示这是UTF-8编码，后三个”E4B8A5”就是”严”的具体编码，它的存储顺序与编码顺序是一致的。</li>
</ol>
<hr>
<h1 id="编码方式">编码方式</h1><h2 id="源文件用不同的编码方式编写，会导致执行结果不一样。">源文件用不同的编码方式编写，会导致执行结果不一样。</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span>&#123;	<span class="keyword">int</span> i = <span class="number">0</span>;	<span class="keyword">unsigned</span> <span class="keyword">char</span> *str=<span class="string">"abc中"</span>;	<span class="keyword">while</span> (str[i])	&#123;		<span class="built_in">printf</span>(<span class="string">"%02x "</span>, str[i]);		i++;	&#125;	<span class="built_in">printf</span>(<span class="string">"\n"</span>);	<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>存为ansi的编码方式时：对于英文文件是ASCII编码，对于简体中文文件是GB2312编码。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">61 62 63 d6 d0</span><br></pre></td></tr></table></figure></p>
<p>存为UTF-8的编码方式输出结果为：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">61 62 63 e4 b8 ad</span><br></pre></td></tr></table></figure></p>
<h2 id="如何解决">如何解决</h2><p>编译程序时，要指定字符集。</p>
<p>查看gcc手册，搜索到charset。</p>
<p>-finput-charset=charset  表示源文件的编码方式, 默认以UTF-8来解析</p>
<p>-fexec-charset=charset   表示可执行程序里的字时候以什么编码方式来表示，默认是UTF-8</p>
<p>示例：</p>
<pre><code>gcc <span class="variable">-finput-charset=</span>GBK <span class="variable">-fexec-charset=</span>UTF-<span class="number">8</span> -o utf-<span class="number">8</span>_2 ansi.c
</code></pre><hr>
<h1 id="英文字母、汉字的点阵显示">英文字母、汉字的点阵显示</h1><p>linux内核中有关于font的文件。比如linux-2.6.30.4/drivers/video/console/font_8x16.c文件，里面有个fontdata_8x16[FONTDATAMAX]数组，每个字符占16字节(8x16像素)。 </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span> 65 0x41 'A' <span class="keyword">*</span>/0x00, /<span class="keyword">*</span> 00000000 <span class="keyword">*</span>/0x00, /<span class="keyword">*</span> 00000000 <span class="keyword">*</span>/0x10, /<span class="keyword">*</span> 00010000 <span class="keyword">*</span>/0x38, /<span class="keyword">*</span> 00111000 <span class="keyword">*</span>/0x6c, /<span class="keyword">*</span> 01101100 <span class="keyword">*</span>/0xc6, /<span class="keyword">*</span> 11000110 <span class="keyword">*</span>/0xc6, /<span class="keyword">*</span> 11000110 <span class="keyword">*</span>/0xfe, /<span class="keyword">*</span> 11111110 <span class="keyword">*</span>/0xc6, /<span class="keyword">*</span> 11000110 <span class="keyword">*</span>/0xc6, /<span class="keyword">*</span> 11000110 <span class="keyword">*</span>/0xc6, /<span class="keyword">*</span> 11000110 <span class="keyword">*</span>/0xc6, /<span class="keyword">*</span> 11000110 <span class="keyword">*</span>/0x00, /<span class="keyword">*</span> 00000000 <span class="keyword">*</span>/0x00, /<span class="keyword">*</span> 00000000 <span class="keyword">*</span>/0x00, /<span class="keyword">*</span> 00000000 <span class="keyword">*</span>/0x00, /<span class="keyword">*</span> 00000000 <span class="keyword">*</span>/</span><br></pre></td></tr></table></figure>
<h2 id="帧缓冲(framebuffer)">帧缓冲(framebuffer)</h2><p>Framebuffer是一块显示缓存，往显示缓存中写入特定的格式数据就意味着向屏幕输出内容。帧缓冲设备对应的设备文件为<code>/dev/fb*</code>,如果系统有多个显示卡，Linux下还可以支持多个帧缓冲设备，最多可达32个（/dev/fb0~/dev/fb31)。帧缓冲设备为标准的字符设备，主设备号为29，此设备号为0~31.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> fd_fb;</span><br><span class="line"><span class="keyword">struct</span> fb_var_screeninfo var;	<span class="comment">/* Current var */</span><span class="keyword">struct</span> fb_fix_screeninfo fix;	<span class="comment">/* Current fix */</span></span><br><span class="line"><span class="keyword">int</span> screen_size; <span class="comment">/*屏幕大小*/</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *fbmem;<span class="comment">/*打开framebuffer设备文件*/</span></span><br><span class="line">fd_fb = open(<span class="string">"/dev/fb0"</span>, O_RDWR);<span class="keyword">if</span> (fd_fb &lt; <span class="number">0</span>)&#123;	<span class="built_in">printf</span>(<span class="string">"can't open /dev/fb0\n"</span>);	<span class="keyword">return</span> -<span class="number">1</span>;&#125;<span class="comment">/*获得可变信息*/</span><span class="keyword">if</span> (ioctl(fd_fb, FBIOGET_VSCREENINFO, &amp;var))&#123;	<span class="built_in">printf</span>(<span class="string">"can't get var\n"</span>);	<span class="keyword">return</span> -<span class="number">1</span>;&#125;<span class="comment">/*获得可变信息*/</span><span class="keyword">if</span> (ioctl(fd_fb, FBIOGET_FSCREENINFO, &amp;fix))&#123;	<span class="built_in">printf</span>(<span class="string">"can't get fix\n"</span>);	<span class="keyword">return</span> -<span class="number">1</span>;&#125;</span><br><span class="line">screen_size = var.xres * var.yres * var.bits_per_pixel / <span class="number">8</span>;<span class="comment">/*单位字节*/</span></span><br><span class="line">fbmem = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)mmap(NULL , screen_size, PROT_READ | PROT_WRITE, MAP_SHARED, fd_fb, <span class="number">0</span>);<span class="comment">/*内存映射*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 清屏: 全部设为黑色 */</span><span class="built_in">memset</span>(fbmem, <span class="number">0</span>, screen_size);</span><br></pre></td></tr></table></figure>
<h2 id="如何在屏幕上画出一个点">如何在屏幕上画出一个点</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> line_width;	<span class="keyword">unsigned</span> <span class="keyword">int</span> pixel_width;</span><br><span class="line">	</span><br><span class="line">	line_width  = var.xres * var.bits_per_pixel / <span class="number">8</span>; <span class="comment">//一行里面有多少字节</span>	pixel_width = var.bits_per_pixel / <span class="number">8</span>; <span class="comment">//每个像素有多少字节</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">lcd_put_pixel</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">int</span> color)</span></span>&#123;	<span class="keyword">unsigned</span> <span class="keyword">char</span> *pen_8 = fbmem+y*line_width+x*pixel_width;<span class="comment">//计算出位置</span>	<span class="keyword">unsigned</span> <span class="keyword">short</span> *pen_16;		<span class="keyword">unsigned</span> <span class="keyword">int</span> *pen_32;		<span class="keyword">unsigned</span> <span class="keyword">int</span> red, green, blue;		pen_16 = (<span class="keyword">unsigned</span> <span class="keyword">short</span> *)pen_8;	pen_32 = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)pen_8;	<span class="keyword">switch</span> (var.bits_per_pixel)<span class="comment">//判断每个像素有多少位，进行不同的处理</span>	&#123;		<span class="keyword">case</span> <span class="number">8</span>:		&#123;			*pen_8 = color;			<span class="keyword">break</span>;		&#125;		<span class="keyword">case</span> <span class="number">16</span>:		&#123;			<span class="comment">/* 565 */</span>			red   = (color &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;			green = (color &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;			blue  = (color &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xff</span>;			color = ((red &gt;&gt; <span class="number">3</span>) &lt;&lt; <span class="number">11</span>) | ((green &gt;&gt; <span class="number">2</span>) &lt;&lt; <span class="number">5</span>) | (blue &gt;&gt; <span class="number">3</span>);			*pen_16 = color;			<span class="keyword">break</span>;		&#125;		<span class="keyword">case</span> <span class="number">32</span>:		&#123;			*pen_32 = color;			<span class="keyword">break</span>;		&#125;		<span class="keyword">default</span>:		&#123;			<span class="built_in">printf</span>(<span class="string">"can't surport %dbpp\n"</span>, var.bits_per_pixel);			<span class="keyword">break</span>;		&#125;	&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="LCD显示ascii码">LCD显示ascii码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lcd_put_ascii</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">char</span> c)</span><span class="comment">//x坐标，y坐标，显示字符</span></span>&#123;	<span class="keyword">unsigned</span> <span class="keyword">char</span> *dots = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)&amp;fontdata_8x16[c*<span class="number">16</span>];<span class="comment">//每个ascii码占16字节</span>	<span class="keyword">int</span> i, b;	<span class="keyword">unsigned</span> <span class="keyword">char</span> byte;	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) <span class="comment">//16行</span>	&#123;		byte = dots[i]; <span class="comment">//取出一个字节</span>		<span class="keyword">for</span> (b = <span class="number">7</span>; b &gt;= <span class="number">0</span>; b--) <span class="comment">//每一行8位</span>		&#123;			<span class="keyword">if</span> (byte &amp; (<span class="number">1</span>&lt;&lt;b))<span class="comment">//判断每一位的值是否为1</span>			&#123;				<span class="comment">/* show */</span>				lcd_put_pixel(x+<span class="number">7</span>-b, y+i, <span class="number">0xffffff</span>); <span class="comment">/* 白 */</span>			&#125;			<span class="keyword">else</span>			&#123;				<span class="comment">/* hide */</span>				lcd_put_pixel(x+<span class="number">7</span>-b, y+i, <span class="number">0</span>); <span class="comment">/* 黑 */</span>			&#125;		&#125;	&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="LCD显示汉字">LCD显示汉字</h2><p>在网上下载hzk16字库。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fd_hzk16;	<span class="keyword">struct</span> stat hzk_stat;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *hzkmem;</span><br><span class="line"><span class="comment">/*打开字库文件*/</span></span><br><span class="line">fd_hzk16 = open(<span class="string">"HZK16"</span>, O_RDONLY);<span class="keyword">if</span> (fd_hzk16 &lt; <span class="number">0</span>)&#123;	<span class="built_in">printf</span>(<span class="string">"can't open HZK16\n"</span>);	<span class="keyword">return</span> -<span class="number">1</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*获取文件属性*/</span><span class="keyword">if</span>(fstat(fd_hzk16, &amp;hzk_stat))&#123;	<span class="built_in">printf</span>(<span class="string">"can't get fstat\n"</span>);	<span class="keyword">return</span> -<span class="number">1</span>;&#125;</span><br><span class="line"><span class="comment">/*内存映射*/</span></span><br><span class="line">hzkmem = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)mmap(NULL , hzk_stat.st_size, PROT_READ, MAP_SHARED, fd_hzk16, <span class="number">0</span>);<span class="keyword">if</span> (hzkmem == (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)-<span class="number">1</span>)&#123;	<span class="built_in">printf</span>(<span class="string">"can't mmap for hzk16\n"</span>);	<span class="keyword">return</span> -<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>根据字库的信息(区码位码上面有介绍)写出代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lcd_put_chinese</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">char</span> *str)</span></span>&#123;	<span class="keyword">unsigned</span> <span class="keyword">int</span> area  = str[<span class="number">0</span>] - <span class="number">0xA1</span>;	<span class="keyword">unsigned</span> <span class="keyword">int</span> where = str[<span class="number">1</span>] - <span class="number">0xA1</span>;	<span class="keyword">unsigned</span> <span class="keyword">char</span> *dots = hzkmem + (area * <span class="number">94</span> + where)*<span class="number">32</span>;	<span class="keyword">unsigned</span> <span class="keyword">char</span> byte;	<span class="keyword">int</span> i, j, b;	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)		&#123;			byte = dots[i*<span class="number">2</span> + j];			<span class="keyword">for</span> (b = <span class="number">7</span>; b &gt;=<span class="number">0</span>; b--)			&#123;				<span class="keyword">if</span> (byte &amp; (<span class="number">1</span>&lt;&lt;b))				&#123;					<span class="comment">/* show */</span>					lcd_put_pixel(x+j*<span class="number">8</span>+<span class="number">7</span>-b, y+i, <span class="number">0xffffff</span>); <span class="comment">/* 白 */</span>				&#125;				<span class="keyword">else</span>				&#123;					<span class="comment">/* hide */</span>					lcd_put_pixel(x+j*<span class="number">8</span>+<span class="number">7</span>-b, y+i, <span class="number">0</span>); <span class="comment">/* 黑 */</span>				&#125;							&#125;		&#125;	&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Freetype">Freetype</h1><p>Freetype 是一个操作字体文件的函数库，可以操作点阵和矢量字体。由于点阵缺乏灵活性，无法改变字体的大小和风格，<strong>矢量字体不像点阵字体那样直接记录字符的字模数据</strong>，而是<strong>记录字体描述信息</strong>。</p>
<ol>
<li>若干个闭合曲线的关键点。</li>
<li>使用数字曲线连接关键点。</li>
<li>填充内部空间。</li>
</ol>
<p>字符对应的字体数据称为<code>glyph</code>,字体文件中通常带有一个字符映射表，用来把字符映射到对应的<code>glyph</code>的索引值。因为字符集的编码方式有很多种（GBK,Unicode,Big5等等)，所以有多个映射表（charmap）。所以一个文字的显示过程：</p>
<ol>
<li>给定一个文字，可以确定它的<code>编码值</code>。（比如‘A’的ascii码的编码值为：0x41）</li>
<li>根据<code>编码值</code>从字体文件中找到<code>glyph</code>(关键点)。</li>
<li>设置字体大小。</li>
<li>利用某些函数把<code>glyph</code>里的点缩放为上面设定的字体大小。</li>
<li>转换为位图点阵。</li>
<li>在LCD上显示出来。</li>
</ol>
<h2 id="代码思路">代码思路</h2><p>google搜索freetype tutorial第一条就是教如何使用。</p>
<ol>
<li>创建freetype库，进行初始化：FT_Init_FreeType</li>
<li>加载字体文件（Load a Font face）: FT_New_Face </li>
<li>设置字体大小：FT_Set_Char_Size 和 FT_Set_Pixel_Sizes </li>
<li>变换（移动和旋转）: FT_Set_Transform</li>
<li>根据编码值，加载<code>glyph</code>（找到，取出，转为位图）</li>
<li>打印</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">	FT_Library	  library;	FT_Face 	  face;</span><br><span class="line">	<span class="keyword">int</span> error;</span><br><span class="line">	FT_Vector     pen; <span class="comment">//矢量</span>	FT_GlyphSlot  slot;	error = FT_Init_FreeType( &amp;library );	<span class="comment">//1.初始化freetype库</span>	error = FT_New_Face( library, argv[<span class="number">1</span>], <span class="number">0</span>, &amp;face ); <span class="comment">//2.加载字体文件</span>	slot = face-&gt;glyph;<span class="comment">//插槽</span></span><br><span class="line">	FT_Set_Pixel_Sizes(face, <span class="number">24</span>, <span class="number">0</span>); <span class="comment">//3.设置字体大小</span></span><br><span class="line">	<span class="comment">/* 确定座标:	 * lcd_x = var.xres/2 + 8 + 16	 * lcd_y = var.yres/2 + 16	 * 笛卡尔座标系:	 * x = lcd_x = var.xres/2 + 8 + 16	 * y = var.yres - lcd_y = var.yres/2 - 16	 */</span>	pen.x = (var.xres/<span class="number">2</span> + <span class="number">8</span> + <span class="number">16</span>) * <span class="number">64</span>;	pen.y = (var.yres/<span class="number">2</span> - <span class="number">16</span>) * <span class="number">64</span>;    FT_Set_Transform( face, <span class="number">0</span>, &amp;pen);<span class="comment">//4.变换</span></span><br><span class="line">    error = FT_Load_Char( face, chinese_str[<span class="number">0</span>], FT_LOAD_RENDER );<span class="comment">//5.转换位图</span></span><br><span class="line">    </span><br><span class="line">    draw_bitmap( &amp;slot-&gt;bitmap,                 slot-&gt;bitmap_left,                 var.yres - slot-&gt;bitmap_top);</span><br><span class="line">                 </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_bitmap</span><span class="params">( FT_Bitmap* bitmap, FT_Int x,  FT_Int y)</span></span>&#123;  FT_Int  i, j, p, q;  FT_Int  x_max = x + bitmap-&gt;width;  FT_Int  y_max = y + bitmap-&gt;rows;  <span class="keyword">for</span> ( i = x, p = <span class="number">0</span>; i &lt; x_max; i++, p++ )  &#123;    <span class="keyword">for</span> ( j = y, q = <span class="number">0</span>; j &lt; y_max; j++, q++ )    &#123;      <span class="keyword">if</span> ( i &lt; <span class="number">0</span>      || j &lt; <span class="number">0</span>       ||           i &gt;= var.xres || j &gt;= var.yres )        <span class="keyword">continue</span>;    &#125;  &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>References:</p>
<ol>
<li><a href="http://www.ruanyifeng.com/blog/2007/10/2. ascii_unicode_and_utf-8.html" target="_blank" rel="external">阮一峰的网络日志</a></li>
<li><a href="http://www.freetype.org/freetype2/docs/tutorial/step1.html" target="_blank" rel="external">freetype tutorial</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/04/08/Polite English/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          Polite English
        
      </div>
    </a>
  
  
    <a href="/2015/02/24/sublime text/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">sublime text 3</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="字符编码" data-title="字符编码" data-url="http://yoursite.com/2015/03/22/字符编码/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Tang Hao
            <a href="mailto:thddaniel92@gmail.com" >发邮件</a>
            
         
            
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Code <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Theme</a> by Litten
      	</div>
    
        <div>
        <form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
         搜索:<input type="search" name="q" id="search" autocomplete="off" autocorrect="off" autocapitalize="off" maxlength="18" placeholder="关键字" />
         <input type="hidden" name="q" value="site:yoursite.com">
        </form>
        </div>
        
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
  <script src="/js/main.js" type="text/javascript"></script> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61735277-1', 'auto');
  ga('send', 'pageview');

</script> 


  </div>
</body>
</html>